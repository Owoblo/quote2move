{"ast":null,"code":"// Real AI Detection Service - Using OpenAI GPT-4 Vision\nexport const detectWithOpenAI = async photoUrls => {\n  const detections = [];\n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with OpenAI:', photoUrl);\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          model: 'gpt-4-vision-preview',\n          messages: [{\n            role: 'user',\n            content: [{\n              type: 'text',\n              text: `Analyze this real estate photo and identify ALL furniture items visible. \n                Return ONLY a valid JSON array with objects containing:\n                - label: furniture type (e.g., \"Sofa\", \"Dining Table\", \"Refrigerator\")\n                - qty: quantity visible (number)\n                - confidence: confidence score 0-1 (number)\n                - notes: brief description (string)\n                \n                Focus on: sofas, chairs, tables, beds, dressers, refrigerators, TVs, bookshelves, desks, cabinets, ottomans, nightstands.\n                Be accurate with quantities - count each visible item.\n                Example: [{\"label\":\"Sofa\",\"qty\":1,\"confidence\":0.95,\"notes\":\"Large sectional sofa in living room\"}]`\n            }, {\n              type: 'image_url',\n              image_url: {\n                url: photoUrl\n              }\n            }]\n          }],\n          max_tokens: 1000\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`OpenAI API error: ${response.status}`);\n      }\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      console.log('OpenAI response:', content);\n\n      // Parse the JSON response\n      const analysis = JSON.parse(content);\n\n      // Add source photo ID to each detection\n      analysis.forEach(item => {\n        detections.push({\n          label: item.label,\n          qty: item.qty || 1,\n          confidence: item.confidence || 0.8,\n          sourcePhotoId: photoUrl,\n          notes: item.notes || `Detected by OpenAI GPT-4 Vision`\n        });\n      });\n    } catch (error) {\n      console.error('OpenAI Vision error:', error);\n      // Continue with other photos even if one fails\n    }\n  }\n  return detections;\n};\n\n// Google Vision API (Alternative)\nexport const detectWithGoogleVision = async photoUrls => {\n  const detections = [];\n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with Google Vision:', photoUrl);\n      const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${process.env.REACT_APP_GOOGLE_VISION_API_KEY}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          requests: [{\n            image: {\n              source: {\n                imageUri: photoUrl\n              }\n            },\n            features: [{\n              type: 'LABEL_DETECTION',\n              maxResults: 50\n            }, {\n              type: 'OBJECT_LOCALIZATION',\n              maxResults: 50\n            }]\n          }]\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Google Vision API error: ${response.status}`);\n      }\n      const data = await response.json();\n\n      // Process Google Vision results\n      if (data.responses && data.responses[0]) {\n        const labels = data.responses[0].labelAnnotations || [];\n\n        // Filter for furniture-related items\n        const furnitureKeywords = ['sofa', 'chair', 'table', 'bed', 'dresser', 'refrigerator', 'television', 'bookshelf', 'desk', 'cabinet', 'ottoman', 'couch', 'dining table', 'coffee table', 'nightstand', 'furniture'];\n        labels.forEach(label => {\n          if (furnitureKeywords.some(keyword => label.description.toLowerCase().includes(keyword))) {\n            detections.push({\n              label: label.description,\n              qty: 1,\n              confidence: label.score,\n              sourcePhotoId: photoUrl,\n              notes: `Detected by Google Vision API`\n            });\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Google Vision API error:', error);\n    }\n  }\n  return detections;\n};\n\n// Deduplicate detections based on similarity\nexport const deduplicateDetections = detections => {\n  const deduplicated = [];\n  const seen = new Set();\n  detections.forEach(detection => {\n    const key = `${detection.label.toLowerCase()}-${detection.qty}`;\n    if (!seen.has(key)) {\n      seen.add(key);\n      deduplicated.push(detection);\n    } else {\n      // Merge quantities for similar items\n      const existing = deduplicated.find(d => d.label.toLowerCase() === detection.label.toLowerCase());\n      if (existing) {\n        existing.qty += detection.qty;\n        existing.confidence = Math.max(existing.confidence, detection.confidence);\n      }\n    }\n  });\n  return deduplicated;\n};\n\n// Main detection function - tries OpenAI first, falls back to Google Vision\nexport const detectFurniture = async photoUrls => {\n  console.log('Starting furniture detection for', photoUrls.length, 'photos');\n  try {\n    // Try OpenAI first (most accurate)\n    if (process.env.REACT_APP_OPENAI_API_KEY) {\n      console.log('Using OpenAI GPT-4 Vision for detection');\n      const detections = await detectWithOpenAI(photoUrls);\n      return deduplicateDetections(detections);\n    }\n\n    // Fallback to Google Vision\n    if (process.env.REACT_APP_GOOGLE_VISION_API_KEY) {\n      console.log('Using Google Vision API for detection');\n      const detections = await detectWithGoogleVision(photoUrls);\n      return deduplicateDetections(detections);\n    }\n\n    // No API keys available\n    throw new Error('No AI API keys configured');\n  } catch (error) {\n    console.error('AI detection failed:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["detectWithOpenAI","photoUrls","detections","photoUrl","console","log","response","fetch","method","headers","process","env","REACT_APP_OPENAI_API_KEY","body","JSON","stringify","model","messages","role","content","type","text","image_url","url","max_tokens","ok","Error","status","data","json","choices","message","analysis","parse","forEach","item","push","label","qty","confidence","sourcePhotoId","notes","error","detectWithGoogleVision","REACT_APP_GOOGLE_VISION_API_KEY","requests","image","source","imageUri","features","maxResults","responses","labels","labelAnnotations","furnitureKeywords","some","keyword","description","toLowerCase","includes","score","deduplicateDetections","deduplicated","seen","Set","detection","key","has","add","existing","find","d","Math","max","detectFurniture","length"],"sources":["/Users/admin/random/src/lib/aiDetectionServices.ts"],"sourcesContent":["import { Detection } from '../types';\n\n// Real AI Detection Service - Using OpenAI GPT-4 Vision\nexport const detectWithOpenAI = async (photoUrls: string[]): Promise<Detection[]> => {\n  const detections: Detection[] = [];\n  \n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with OpenAI:', photoUrl);\n      \n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model: 'gpt-4-vision-preview',\n          messages: [{\n            role: 'user',\n            content: [\n              {\n                type: 'text',\n                text: `Analyze this real estate photo and identify ALL furniture items visible. \n                Return ONLY a valid JSON array with objects containing:\n                - label: furniture type (e.g., \"Sofa\", \"Dining Table\", \"Refrigerator\")\n                - qty: quantity visible (number)\n                - confidence: confidence score 0-1 (number)\n                - notes: brief description (string)\n                \n                Focus on: sofas, chairs, tables, beds, dressers, refrigerators, TVs, bookshelves, desks, cabinets, ottomans, nightstands.\n                Be accurate with quantities - count each visible item.\n                Example: [{\"label\":\"Sofa\",\"qty\":1,\"confidence\":0.95,\"notes\":\"Large sectional sofa in living room\"}]`\n              },\n              {\n                type: 'image_url',\n                image_url: { url: photoUrl }\n              }\n            ]\n          }],\n          max_tokens: 1000\n        })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`OpenAI API error: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      \n      console.log('OpenAI response:', content);\n      \n      // Parse the JSON response\n      const analysis = JSON.parse(content);\n      \n      // Add source photo ID to each detection\n      analysis.forEach((item: any) => {\n        detections.push({\n          label: item.label,\n          qty: item.qty || 1,\n          confidence: item.confidence || 0.8,\n          sourcePhotoId: photoUrl,\n          notes: item.notes || `Detected by OpenAI GPT-4 Vision`\n        });\n      });\n      \n    } catch (error) {\n      console.error('OpenAI Vision error:', error);\n      // Continue with other photos even if one fails\n    }\n  }\n  \n  return detections;\n};\n\n// Google Vision API (Alternative)\nexport const detectWithGoogleVision = async (photoUrls: string[]): Promise<Detection[]> => {\n  const detections: Detection[] = [];\n  \n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with Google Vision:', photoUrl);\n      \n      const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${process.env.REACT_APP_GOOGLE_VISION_API_KEY}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          requests: [{\n            image: { source: { imageUri: photoUrl } },\n            features: [\n              { type: 'LABEL_DETECTION', maxResults: 50 },\n              { type: 'OBJECT_LOCALIZATION', maxResults: 50 }\n            ]\n          }]\n        })\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Google Vision API error: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      // Process Google Vision results\n      if (data.responses && data.responses[0]) {\n        const labels = data.responses[0].labelAnnotations || [];\n        \n        // Filter for furniture-related items\n        const furnitureKeywords = [\n          'sofa', 'chair', 'table', 'bed', 'dresser', 'refrigerator', \n          'television', 'bookshelf', 'desk', 'cabinet', 'ottoman',\n          'couch', 'dining table', 'coffee table', 'nightstand', 'furniture'\n        ];\n        \n        labels.forEach((label: any) => {\n          if (furnitureKeywords.some(keyword => \n            label.description.toLowerCase().includes(keyword)\n          )) {\n            detections.push({\n              label: label.description,\n              qty: 1,\n              confidence: label.score,\n              sourcePhotoId: photoUrl,\n              notes: `Detected by Google Vision API`\n            });\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Google Vision API error:', error);\n    }\n  }\n  \n  return detections;\n};\n\n// Deduplicate detections based on similarity\nexport const deduplicateDetections = (detections: Detection[]): Detection[] => {\n  const deduplicated: Detection[] = [];\n  const seen = new Set<string>();\n  \n  detections.forEach(detection => {\n    const key = `${detection.label.toLowerCase()}-${detection.qty}`;\n    \n    if (!seen.has(key)) {\n      seen.add(key);\n      deduplicated.push(detection);\n    } else {\n      // Merge quantities for similar items\n      const existing = deduplicated.find(d => \n        d.label.toLowerCase() === detection.label.toLowerCase()\n      );\n      if (existing) {\n        existing.qty += detection.qty;\n        existing.confidence = Math.max(existing.confidence, detection.confidence);\n      }\n    }\n  });\n  \n  return deduplicated;\n};\n\n// Main detection function - tries OpenAI first, falls back to Google Vision\nexport const detectFurniture = async (photoUrls: string[]): Promise<Detection[]> => {\n  console.log('Starting furniture detection for', photoUrls.length, 'photos');\n  \n  try {\n    // Try OpenAI first (most accurate)\n    if (process.env.REACT_APP_OPENAI_API_KEY) {\n      console.log('Using OpenAI GPT-4 Vision for detection');\n      const detections = await detectWithOpenAI(photoUrls);\n      return deduplicateDetections(detections);\n    }\n    \n    // Fallback to Google Vision\n    if (process.env.REACT_APP_GOOGLE_VISION_API_KEY) {\n      console.log('Using Google Vision API for detection');\n      const detections = await detectWithGoogleVision(photoUrls);\n      return deduplicateDetections(detections);\n    }\n    \n    // No API keys available\n    throw new Error('No AI API keys configured');\n    \n  } catch (error) {\n    console.error('AI detection failed:', error);\n    throw error;\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}