{"ast":null,"code":"// OpenAI GPT-4 Vision - PRIMARY AND ONLY detection method for maximum accuracy\nexport const detectFurniture = async photoUrls => {\n  console.log('Starting OpenAI GPT-4 Vision detection for', photoUrls.length, 'photos');\n  console.log('OpenAI API Key configured:', !!process.env.REACT_APP_OPENAI_API_KEY);\n  if (!process.env.REACT_APP_OPENAI_API_KEY) {\n    throw new Error('OpenAI API key not configured');\n  }\n  const allDetections = [];\n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with OpenAI GPT-4 Vision:', photoUrl);\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          model: 'gpt-4o',\n          // Using latest GPT-4o model for best accuracy\n          messages: [{\n            role: 'user',\n            content: [{\n              type: 'text',\n              text: `You are a professional furniture inventory specialist. Analyze this real estate photo with EXTREME PRECISION and identify EVERY piece of furniture, appliance, and household item visible.\n\nCRITICAL REQUIREMENTS FOR MAXIMUM ACCURACY:\n1. COUNT EXACT QUANTITIES - If you see 4 dining chairs, write qty: 4\n2. BE HIGHLY SPECIFIC - \"Large Oak Dining Table\", \"Sectional Sofa with Ottoman\", \"King Size Platform Bed\"\n3. INCLUDE ROOM CONTEXT - \"Master Bedroom Dresser\", \"Kitchen Island Stools\", \"Living Room Coffee Table\"\n4. DISTINGUISH SIMILAR ITEMS - \"Coffee Table\" vs \"End Table\" vs \"Console Table\"\n5. INCLUDE SIZE DESCRIPTORS - Large, Small, Tall, Wide, Narrow when visible\n6. DETECT ALL ITEMS - Don't miss anything, even small items like lamps, pillows, decor\n\nFURNITURE CATEGORIES TO DETECT:\n- SEATING: Sofas, Sectionals, Loveseats, Recliners, Chairs (Dining, Office, Accent), Ottomans, Benches\n- TABLES: Dining Tables, Coffee Tables, End Tables, Console Tables, Side Tables, Kitchen Islands\n- BEDS: King Beds, Queen Beds, Twin Beds, Bunk Beds, Daybeds, Futons\n- STORAGE: Dressers, Chests of Drawers, Nightstands, Bookshelves, Cabinets, Wardrobes, Closets\n- APPLIANCES: Refrigerators, Stoves, Ovens, Microwaves, Dishwashers, Washers, Dryers, Toasters\n- ELECTRONICS: TVs, Monitors, Computers, Laptops, Sound Systems, Gaming Consoles\n- DECOR: Lamps, Mirrors, Artwork, Plants, Vases, Clocks, Rugs\n- KITCHEN: Kitchen Cabinets, Pantries, Wine Racks, Bar Stools\n- BATHROOM: Vanities, Medicine Cabinets, Towel Racks, Shower Curtains\n\nReturn ONLY a valid JSON array with objects containing:\n- label: VERY SPECIFIC furniture type with descriptors (string)\n- qty: EXACT quantity visible (number) \n- confidence: confidence score 0-1 (number)\n- notes: room location and specific details (string)\n- room: room type (string)\n- size: size descriptor if visible (string)\n\nEXAMPLE OUTPUT:\n[\n  {\n    \"label\": \"Large Oak Dining Table\",\n    \"qty\": 1,\n    \"confidence\": 0.98,\n    \"notes\": \"Dining room centerpiece, seats 6-8 people\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Large\"\n  },\n  {\n    \"label\": \"Dining Chairs\",\n    \"qty\": 6,\n    \"confidence\": 0.95,\n    \"notes\": \"Matching upholstered dining chairs around table\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Standard\"\n  }\n]\n\nBe extremely thorough and accurate. Count every single item you can see.`\n            }, {\n              type: 'image_url',\n              image_url: {\n                url: photoUrl,\n                detail: 'high' // Maximum detail for best accuracy\n              }\n            }]\n          }],\n          max_tokens: 2000,\n          // Increased for detailed responses\n          temperature: 0.1 // Low temperature for consistent, accurate results\n        })\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('OpenAI API error:', response.status, errorText);\n        continue;\n      }\n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      console.log('OpenAI response:', content);\n\n      // Parse the JSON response\n      try {\n        const analysis = JSON.parse(content);\n\n        // Add source photo ID to each detection\n        analysis.forEach(item => {\n          allDetections.push({\n            label: item.label,\n            qty: item.qty || 1,\n            confidence: item.confidence || 0.9,\n            sourcePhotoId: photoUrl,\n            notes: item.notes || `Detected by OpenAI GPT-4o`,\n            room: item.room || 'Unknown Room',\n            size: item.size || ''\n          });\n        });\n        console.log(`Detected ${analysis.length} items in photo`);\n      } catch (parseError) {\n        console.error('Failed to parse OpenAI response:', parseError);\n        console.log('Raw response:', content);\n      }\n    } catch (error) {\n      console.error('OpenAI Vision error:', error);\n      // Continue with other photos even if one fails\n    }\n  }\n  console.log(`Total detections: ${allDetections.length}`);\n  return deduplicateDetections(allDetections);\n};\n\n// Enhanced deduplication for maximum accuracy\nconst deduplicateDetections = detections => {\n  const deduplicated = [];\n  const seen = new Map();\n  detections.forEach(detection => {\n    // Create a sophisticated key that includes room and size context\n    const normalizedLabel = detection.label.toLowerCase().replace(/\\b(large|small|big|little|tall|short|wide|narrow|standard|medium)\\b/g, '').replace(/\\s+/g, ' ').trim();\n    const key = `${normalizedLabel}-${detection.room}-${detection.sourcePhotoId}`;\n    if (!seen.has(key)) {\n      seen.set(key, detection);\n      deduplicated.push(detection);\n    } else {\n      // Merge quantities for similar items in the same photo and room\n      const existing = seen.get(key);\n      existing.qty += detection.qty;\n      existing.confidence = Math.max(existing.confidence, detection.confidence);\n\n      // Update notes to include both descriptions\n      if (detection.notes && detection.notes !== existing.notes) {\n        existing.notes = `${existing.notes}; ${detection.notes}`;\n      }\n    }\n  });\n  console.log(`After deduplication: ${deduplicated.length} unique items`);\n  return deduplicated;\n};","map":{"version":3,"names":["detectFurniture","photoUrls","console","log","length","process","env","REACT_APP_OPENAI_API_KEY","Error","allDetections","photoUrl","response","fetch","method","headers","body","JSON","stringify","model","messages","role","content","type","text","image_url","url","detail","max_tokens","temperature","ok","errorText","error","status","data","json","choices","message","analysis","parse","forEach","item","push","label","qty","confidence","sourcePhotoId","notes","room","size","parseError","deduplicateDetections","detections","deduplicated","seen","Map","detection","normalizedLabel","toLowerCase","replace","trim","key","has","set","existing","get","Math","max"],"sources":["/Users/admin/random/src/lib/aiDetectionServices.ts"],"sourcesContent":["import { Detection } from '../types';\n\n// OpenAI GPT-4 Vision - PRIMARY AND ONLY detection method for maximum accuracy\nexport const detectFurniture = async (photoUrls: string[]): Promise<Detection[]> => {\n  console.log('Starting OpenAI GPT-4 Vision detection for', photoUrls.length, 'photos');\n  console.log('OpenAI API Key configured:', !!process.env.REACT_APP_OPENAI_API_KEY);\n  \n  if (!process.env.REACT_APP_OPENAI_API_KEY) {\n    throw new Error('OpenAI API key not configured');\n  }\n\n  const allDetections: Detection[] = [];\n  \n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with OpenAI GPT-4 Vision:', photoUrl);\n      \n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model: 'gpt-4o', // Using latest GPT-4o model for best accuracy\n          messages: [{\n            role: 'user',\n            content: [\n              {\n                type: 'text',\n                text: `You are a professional furniture inventory specialist. Analyze this real estate photo with EXTREME PRECISION and identify EVERY piece of furniture, appliance, and household item visible.\n\nCRITICAL REQUIREMENTS FOR MAXIMUM ACCURACY:\n1. COUNT EXACT QUANTITIES - If you see 4 dining chairs, write qty: 4\n2. BE HIGHLY SPECIFIC - \"Large Oak Dining Table\", \"Sectional Sofa with Ottoman\", \"King Size Platform Bed\"\n3. INCLUDE ROOM CONTEXT - \"Master Bedroom Dresser\", \"Kitchen Island Stools\", \"Living Room Coffee Table\"\n4. DISTINGUISH SIMILAR ITEMS - \"Coffee Table\" vs \"End Table\" vs \"Console Table\"\n5. INCLUDE SIZE DESCRIPTORS - Large, Small, Tall, Wide, Narrow when visible\n6. DETECT ALL ITEMS - Don't miss anything, even small items like lamps, pillows, decor\n\nFURNITURE CATEGORIES TO DETECT:\n- SEATING: Sofas, Sectionals, Loveseats, Recliners, Chairs (Dining, Office, Accent), Ottomans, Benches\n- TABLES: Dining Tables, Coffee Tables, End Tables, Console Tables, Side Tables, Kitchen Islands\n- BEDS: King Beds, Queen Beds, Twin Beds, Bunk Beds, Daybeds, Futons\n- STORAGE: Dressers, Chests of Drawers, Nightstands, Bookshelves, Cabinets, Wardrobes, Closets\n- APPLIANCES: Refrigerators, Stoves, Ovens, Microwaves, Dishwashers, Washers, Dryers, Toasters\n- ELECTRONICS: TVs, Monitors, Computers, Laptops, Sound Systems, Gaming Consoles\n- DECOR: Lamps, Mirrors, Artwork, Plants, Vases, Clocks, Rugs\n- KITCHEN: Kitchen Cabinets, Pantries, Wine Racks, Bar Stools\n- BATHROOM: Vanities, Medicine Cabinets, Towel Racks, Shower Curtains\n\nReturn ONLY a valid JSON array with objects containing:\n- label: VERY SPECIFIC furniture type with descriptors (string)\n- qty: EXACT quantity visible (number) \n- confidence: confidence score 0-1 (number)\n- notes: room location and specific details (string)\n- room: room type (string)\n- size: size descriptor if visible (string)\n\nEXAMPLE OUTPUT:\n[\n  {\n    \"label\": \"Large Oak Dining Table\",\n    \"qty\": 1,\n    \"confidence\": 0.98,\n    \"notes\": \"Dining room centerpiece, seats 6-8 people\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Large\"\n  },\n  {\n    \"label\": \"Dining Chairs\",\n    \"qty\": 6,\n    \"confidence\": 0.95,\n    \"notes\": \"Matching upholstered dining chairs around table\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Standard\"\n  }\n]\n\nBe extremely thorough and accurate. Count every single item you can see.`\n              },\n              {\n                type: 'image_url',\n                image_url: { \n                  url: photoUrl,\n                  detail: 'high' // Maximum detail for best accuracy\n                }\n              }\n            ]\n          }],\n          max_tokens: 2000, // Increased for detailed responses\n          temperature: 0.1 // Low temperature for consistent, accurate results\n        })\n      });\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('OpenAI API error:', response.status, errorText);\n        continue;\n      }\n      \n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      \n      console.log('OpenAI response:', content);\n      \n      // Parse the JSON response\n      try {\n        const analysis = JSON.parse(content);\n        \n        // Add source photo ID to each detection\n        analysis.forEach((item: any) => {\n          allDetections.push({\n            label: item.label,\n            qty: item.qty || 1,\n            confidence: item.confidence || 0.9,\n            sourcePhotoId: photoUrl,\n            notes: item.notes || `Detected by OpenAI GPT-4o`,\n            room: item.room || 'Unknown Room',\n            size: item.size || ''\n          });\n        });\n        \n        console.log(`Detected ${analysis.length} items in photo`);\n        \n      } catch (parseError) {\n        console.error('Failed to parse OpenAI response:', parseError);\n        console.log('Raw response:', content);\n      }\n      \n    } catch (error) {\n      console.error('OpenAI Vision error:', error);\n      // Continue with other photos even if one fails\n    }\n  }\n  \n  console.log(`Total detections: ${allDetections.length}`);\n  return deduplicateDetections(allDetections);\n};\n\n// Enhanced deduplication for maximum accuracy\nconst deduplicateDetections = (detections: Detection[]): Detection[] => {\n  const deduplicated: Detection[] = [];\n  const seen = new Map<string, Detection>();\n  \n  detections.forEach(detection => {\n    // Create a sophisticated key that includes room and size context\n    const normalizedLabel = detection.label.toLowerCase()\n      .replace(/\\b(large|small|big|little|tall|short|wide|narrow|standard|medium)\\b/g, '')\n      .replace(/\\s+/g, ' ')\n      .trim();\n    \n    const key = `${normalizedLabel}-${detection.room}-${detection.sourcePhotoId}`;\n    \n    if (!seen.has(key)) {\n      seen.set(key, detection);\n      deduplicated.push(detection);\n    } else {\n      // Merge quantities for similar items in the same photo and room\n      const existing = seen.get(key)!;\n      existing.qty += detection.qty;\n      existing.confidence = Math.max(existing.confidence, detection.confidence);\n      \n      // Update notes to include both descriptions\n      if (detection.notes && detection.notes !== existing.notes) {\n        existing.notes = `${existing.notes}; ${detection.notes}`;\n      }\n    }\n  });\n  \n  console.log(`After deduplication: ${deduplicated.length} unique items`);\n  return deduplicated;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}