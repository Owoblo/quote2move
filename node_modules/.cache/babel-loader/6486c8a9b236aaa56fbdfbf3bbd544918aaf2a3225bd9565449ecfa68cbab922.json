{"ast":null,"code":"import{supabase}from'./supabase';export class ProjectService{// Save a project/quote\nstatic async saveProject(address,detections,estimate,projectName,notes){const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('User must be logged in to save projects');}const projectData={user_id:user.id,address,detections,estimate,project_name:projectName||address||'Untitled Project',notes:notes||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};const{data,error}=await supabase.from('projects').insert([projectData]).select().single();if(error){console.error('Error saving project:',error);throw new Error(\"Failed to save project: \".concat(error.message));}return data;}// Get all projects for the current user\nstatic async getUserProjects(){const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('User must be logged in to view projects');}const{data,error}=await supabase.from('projects').select('*').eq('user_id',user.id).order('updated_at',{ascending:false});if(error){console.error('Error loading projects:',error);throw new Error(\"Failed to load projects: \".concat(error.message));}return data||[];}// Get a single project by ID\nstatic async getProject(projectId){const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('User must be logged in to view projects');}const{data,error}=await supabase.from('projects').select('*').eq('id',projectId).eq('user_id',user.id).single();if(error){console.error('Error loading project:',error);throw new Error(\"Failed to load project: \".concat(error.message));}if(!data){throw new Error('Project not found');}return data;}// Update an existing project\nstatic async updateProject(projectId,address,detections,estimate,projectName,notes){const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('User must be logged in to update projects');}const{data,error}=await supabase.from('projects').update({address,detections,estimate,project_name:projectName||address||'Untitled Project',notes:notes||null,updated_at:new Date().toISOString()}).eq('id',projectId).eq('user_id',user.id).select().single();if(error){console.error('Error updating project:',error);throw new Error(\"Failed to update project: \".concat(error.message));}return data;}// Delete a project\nstatic async deleteProject(projectId){const{data:{user}}=await supabase.auth.getUser();if(!user){throw new Error('User must be logged in to delete projects');}const{error}=await supabase.from('projects').delete().eq('id',projectId).eq('user_id',user.id);if(error){console.error('Error deleting project:',error);throw new Error(\"Failed to delete project: \".concat(error.message));}}}","map":{"version":3,"names":["supabase","ProjectService","saveProject","address","detections","estimate","projectName","notes","data","user","auth","getUser","Error","projectData","user_id","id","project_name","created_at","Date","toISOString","updated_at","error","from","insert","select","single","console","concat","message","getUserProjects","eq","order","ascending","getProject","projectId","updateProject","update","deleteProject","delete"],"sources":["/Users/admin/random/src/lib/projectService.ts"],"sourcesContent":["import { supabase } from './supabase';\nimport { QuotePayload, Detection } from '../types';\n\nexport interface Project {\n  id: string;\n  user_id: string;\n  address: string;\n  detections: Detection[];\n  estimate: QuotePayload['estimate'];\n  created_at: string;\n  updated_at: string;\n  notes?: string;\n  project_name?: string;\n}\n\nexport class ProjectService {\n  // Save a project/quote\n  static async saveProject(\n    address: string,\n    detections: Detection[],\n    estimate: QuotePayload['estimate'],\n    projectName?: string,\n    notes?: string\n  ): Promise<Project> {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('User must be logged in to save projects');\n    }\n\n    const projectData = {\n      user_id: user.id,\n      address,\n      detections,\n      estimate,\n      project_name: projectName || address || 'Untitled Project',\n      notes: notes || null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n\n    const { data, error } = await supabase\n      .from('projects')\n      .insert([projectData])\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error saving project:', error);\n      throw new Error(`Failed to save project: ${error.message}`);\n    }\n\n    return data;\n  }\n\n  // Get all projects for the current user\n  static async getUserProjects(): Promise<Project[]> {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('User must be logged in to view projects');\n    }\n\n    const { data, error } = await supabase\n      .from('projects')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('updated_at', { ascending: false });\n\n    if (error) {\n      console.error('Error loading projects:', error);\n      throw new Error(`Failed to load projects: ${error.message}`);\n    }\n\n    return data || [];\n  }\n\n  // Get a single project by ID\n  static async getProject(projectId: string): Promise<Project> {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('User must be logged in to view projects');\n    }\n\n    const { data, error } = await supabase\n      .from('projects')\n      .select('*')\n      .eq('id', projectId)\n      .eq('user_id', user.id)\n      .single();\n\n    if (error) {\n      console.error('Error loading project:', error);\n      throw new Error(`Failed to load project: ${error.message}`);\n    }\n\n    if (!data) {\n      throw new Error('Project not found');\n    }\n\n    return data;\n  }\n\n  // Update an existing project\n  static async updateProject(\n    projectId: string,\n    address: string,\n    detections: Detection[],\n    estimate: QuotePayload['estimate'],\n    projectName?: string,\n    notes?: string\n  ): Promise<Project> {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('User must be logged in to update projects');\n    }\n\n    const { data, error } = await supabase\n      .from('projects')\n      .update({\n        address,\n        detections,\n        estimate,\n        project_name: projectName || address || 'Untitled Project',\n        notes: notes || null,\n        updated_at: new Date().toISOString(),\n      })\n      .eq('id', projectId)\n      .eq('user_id', user.id)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Error updating project:', error);\n      throw new Error(`Failed to update project: ${error.message}`);\n    }\n\n    return data;\n  }\n\n  // Delete a project\n  static async deleteProject(projectId: string): Promise<void> {\n    const { data: { user } } = await supabase.auth.getUser();\n    \n    if (!user) {\n      throw new Error('User must be logged in to delete projects');\n    }\n\n    const { error } = await supabase\n      .from('projects')\n      .delete()\n      .eq('id', projectId)\n      .eq('user_id', user.id);\n\n    if (error) {\n      console.error('Error deleting project:', error);\n      throw new Error(`Failed to delete project: ${error.message}`);\n    }\n  }\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}