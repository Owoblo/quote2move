{"ast":null,"code":"import{estimateCubicFeet,estimateWeight}from'./cubicFeetEstimator';// OpenAI GPT-4 Vision - PRIMARY AND ONLY detection method for maximum accuracy\nexport const detectFurniture=async photoUrls=>{console.log('Starting OpenAI GPT-4 Vision detection for',photoUrls.length,'photos');console.log('OpenAI API Key configured:',!!process.env.REACT_APP_OPENAI_API_KEY);if(!process.env.REACT_APP_OPENAI_API_KEY){throw new Error('OpenAI API key not configured');}const allDetections=[];for(const photoUrl of photoUrls){try{console.log('Analyzing photo with OpenAI GPT-4 Vision:',photoUrl);const response=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Authorization':\"Bearer \".concat(process.env.REACT_APP_OPENAI_API_KEY),'Content-Type':'application/json'},body:JSON.stringify({model:'gpt-4o',// Using latest GPT-4o model for best accuracy\nmessages:[{role:'user',content:[{type:'text',text:\"You are a professional MOVING COMPANY inventory specialist. Analyze this real estate photo and identify ONLY items that professional movers can physically move and transport.\\n\\n\\uD83D\\uDE9A MOVER'S INVENTORY - ONLY DETECT MOVABLE ITEMS:\\n\\n\\u2705 MOVABLE FURNITURE & ITEMS (DETECT THESE):\\n- SEATING: Sofas, Sectionals, Loveseats, Recliners, Chairs (Dining, Office, Accent), Ottomans, Benches, Stools\\n- TABLES: Dining Tables, Coffee Tables, End Tables, Console Tables, Side Tables, Kitchen Islands (if freestanding)\\n- BEDS: King Beds, Queen Beds, Twin Beds, Bunk Beds, Daybeds, Futons, Mattresses, Box Springs\\n- STORAGE: Dressers, Chests of Drawers, Nightstands, Bookshelves, Freestanding Cabinets, Wardrobes, Armoires\\n- APPLIANCES: Refrigerators, Stoves, Ovens, Microwaves, Dishwashers, Washers, Dryers, Toasters, Coffee Makers\\n- ELECTRONICS: TVs, Monitors, Computers, Laptops, Sound Systems, Gaming Consoles, Speakers\\n- DECOR: Floor Lamps, Table Lamps, Mirrors (wall-mounted), Artwork, Plants, Vases, Clocks, Area Rugs\\n- KITCHEN: Freestanding Pantries, Wine Racks, Bar Stools, Kitchen Carts\\n- OUTDOOR: Patio Furniture, Grills, Outdoor Chairs/Tables\\n\\n\\u274C DO NOT DETECT (FIXED INSTALLATIONS):\\n- Built-in cabinets, Built-in shelving, Built-in vanities\\n- Chandeliers, Ceiling fans, Light fixtures\\n- Built-in appliances (dishwashers, built-in ovens)\\n- Built-in bathroom vanities, Medicine cabinets\\n- Built-in wardrobes, Built-in closets\\n- Wall-mounted items (unless easily removable)\\n- Built-in countertops, Built-in islands\\n- Fixed mirrors, Built-in mirrors\\n- Built-in seating, Built-in benches\\n\\nCRITICAL REQUIREMENTS:\\n1. COUNT EXACT QUANTITIES - If you see 4 dining chairs, write qty: 4\\n2. BE HIGHLY SPECIFIC - \\\"Large Oak Dining Table\\\", \\\"Sectional Sofa with Ottoman\\\", \\\"King Size Platform Bed\\\"\\n3. INCLUDE ROOM CONTEXT - \\\"Master Bedroom Dresser\\\", \\\"Kitchen Island Stools\\\", \\\"Living Room Coffee Table\\\"\\n4. DISTINGUISH SIMILAR ITEMS - \\\"Coffee Table\\\" vs \\\"End Table\\\" vs \\\"Console Table\\\"\\n5. SIZE DESCRIPTORS - CRITICAL FOR MOVERS:\\n   - TVs: Estimate screen size in inches (e.g., \\\"40-50 inch TV\\\", \\\"55-65 inch TV\\\", \\\"70+ inch TV\\\"). If unsure, provide a reasonable range based on visual scale compared to furniture nearby.\\n   - Furniture: Provide dimensions or size range when possible (e.g., \\\"Large (7-8 ft)\\\", \\\"Small (4-5 ft)\\\", \\\"Queen Size\\\", \\\"King Size\\\"). Estimate based on visual scale or standard sizes.\\n   - If exact size is unclear, provide a reasonable range (e.g., \\\"Medium-Large\\\", \\\"30-40 inches wide\\\")\\n6. ONLY MOVABLE ITEMS - Skip anything permanently attached or built-in\\n\\nReturn ONLY a valid JSON array with objects containing:\\n- label: VERY SPECIFIC movable furniture type with descriptors (string)\\n- qty: EXACT quantity visible (number) \\n- confidence: confidence score 0-1 (number)\\n- notes: room location and specific details (string)\\n- room: room type (string)\\n- size: size descriptor with specific measurements or ranges - CRITICAL for TVs: estimate inches (e.g., \\\"55-inch\\\", \\\"65-75 inch range\\\"). For furniture: dimensions or size category with ranges (e.g., \\\"Large (7-8 ft)\\\", \\\"Queen Size\\\", \\\"30-40 inches wide\\\")\\n- cubicFeet: **REQUIRED** - estimated cubic feet volume for this item (number). ALWAYS provide this field using standard moving industry estimates. Examples:\\n  * Sofa (3-cushion): 35 cu ft\\n  * Loveseat: 30 cu ft\\n  * Dining chair: 5 cu ft\\n  * Dining table (4-6 seater): 30 cu ft\\n  * Queen bed: 65 cu ft\\n  * King bed: 70 cu ft\\n  * Dresser (medium): 40 cu ft\\n  * TV 55\\\": 45 cu ft\\n  * TV 60\\\"+: 55 cu ft\\n  * Refrigerator: 35 cu ft\\n  * Washer/Dryer: 25 cu ft each\\n  * Piano (upright): 70 cu ft\\n  * Pool table: 40 cu ft\\n  * For items not listed, estimate based on dimensions and industry standards\\n- weight: **REQUIRED** - estimated weight in pounds (number). ALWAYS provide this field using Saturn Star Movers cube sheet standards:\\n  * 3-cushion sofa: 245 lbs\\n  * Loveseat: 210 lbs\\n  * Armchair: 105 lbs\\n  * Dining chair: 35 lbs\\n  * Dining table: 210 lbs\\n  * Coffee table: 84 lbs\\n  * End table: 35 lbs\\n  * Queen bed: 455 lbs\\n  * King bed: 490 lbs\\n  * Dresser (medium): 280 lbs\\n  * Dresser (large 8+): 350 lbs\\n  * TV 40-49\\\": 280 lbs\\n  * TV 50-59\\\": 315 lbs\\n  * TV 60\\\"+: 385 lbs\\n  * Refrigerator (\\u22646 cu ft): 210 lbs\\n  * Refrigerator (7-10 cu ft): 315 lbs\\n  * Washer/Dryer: 175 lbs each\\n  * Microwave: 70 lbs\\n  * Upright piano: 490 lbs\\n  * Baby grand piano: 560 lbs\\n  * Pool table: 280 lbs\\n  * Box (medium): 21 lbs\\n  * Box (large): 42 lbs\\n  * For other items: use ~7 lbs per cubic foot as rule of thumb\\n\\nEXAMPLE OUTPUT:\\n[\\n  {\\n    \\\"label\\\": \\\"Large Oak Dining Table\\\",\\n    \\\"qty\\\": 1,\\n    \\\"confidence\\\": 0.98,\\n    \\\"notes\\\": \\\"Dining room centerpiece, seats 6-8 people\\\",\\n    \\\"room\\\": \\\"Dining Room\\\",\\n    \\\"size\\\": \\\"Large\\\",\\n    \\\"cubicFeet\\\": 30,\\n    \\\"weight\\\": 210\\n  },\\n  {\\n    \\\"label\\\": \\\"Dining Chairs\\\",\\n    \\\"qty\\\": 6,\\n    \\\"confidence\\\": 0.95,\\n    \\\"notes\\\": \\\"Matching upholstered dining chairs around table\\\",\\n    \\\"room\\\": \\\"Dining Room\\\",\\n    \\\"size\\\": \\\"Standard\\\",\\n    \\\"cubicFeet\\\": 5,\\n    \\\"weight\\\": 35\\n  },\\n  {\\n    \\\"label\\\": \\\"TV\\\",\\n    \\\"qty\\\": 1,\\n    \\\"confidence\\\": 0.92,\\n    \\\"notes\\\": \\\"Wall-mounted TV in living room\\\",\\n    \\\"room\\\": \\\"Living Room\\\",\\n    \\\"size\\\": \\\"55-65 inch range\\\",\\n    \\\"cubicFeet\\\": 45,\\n    \\\"weight\\\": 315\\n  },\\n  {\\n    \\\"label\\\": \\\"Coffee Table\\\",\\n    \\\"qty\\\": 1,\\n    \\\"confidence\\\": 0.90,\\n    \\\"notes\\\": \\\"Center of living room\\\",\\n    \\\"room\\\": \\\"Living Room\\\",\\n    \\\"size\\\": \\\"Large (5-6 ft long)\\\",\\n    \\\"cubicFeet\\\": 12,\\n    \\\"weight\\\": 84\\n  }\\n]\\n\\nRemember: Only detect items that professional movers can physically pick up and transport. Skip built-in, fixed, or permanently installed items.\"},{type:'image_url',image_url:{url:photoUrl,detail:'high'// Maximum detail for best accuracy\n}}]}],max_tokens:2000,// Increased for detailed responses\ntemperature:0.1// Low temperature for consistent, accurate results\n})});if(!response.ok){const errorText=await response.text();console.error('OpenAI API error:',response.status,errorText);continue;}const data=await response.json();const content=data.choices[0].message.content;console.log('OpenAI response:',content);// Parse the JSON response\ntry{// Clean the response by removing markdown code blocks\nlet cleanContent=content.trim();if(cleanContent.startsWith('```json')){cleanContent=cleanContent.replace(/^```json\\s*/,'').replace(/\\s*```$/,'');}else if(cleanContent.startsWith('```')){cleanContent=cleanContent.replace(/^```\\s*/,'').replace(/\\s*```$/,'');}const analysis=JSON.parse(cleanContent);// Add source photo ID to each detection\nanalysis.forEach(item=>{// Use detected cubicFeet/weight if provided, otherwise estimate\nlet cubicFeet=item.cubicFeet;let weight=item.weight;if(!cubicFeet||cubicFeet===0){// Fallback to estimator\ncubicFeet=estimateCubicFeet(item.label,item.size);console.log(\"\\u26A0\\uFE0F Missing cubicFeet for \\\"\".concat(item.label,\"\\\", estimated: \").concat(cubicFeet,\" cu ft\"));}if(!weight||weight===0){// Estimate weight from cubic feet and item label (more accurate)\nweight=estimateWeight(cubicFeet,item.label,item.size);}allDetections.push({label:item.label,qty:item.qty||1,confidence:item.confidence||0.9,sourcePhotoId:photoUrl,notes:item.notes||\"Detected by OpenAI GPT-4o\",room:item.room||'Unknown Room',size:item.size||'',cubicFeet:cubicFeet,weight:weight});});console.log(\"Detected \".concat(analysis.length,\" items in photo\"));}catch(parseError){console.error('Failed to parse OpenAI response:',parseError);console.log('Raw response:',content);}}catch(error){console.error('OpenAI Vision error:',error);// Continue with other photos even if one fails\n}}console.log(\"Total detections before deduplication: \".concat(allDetections.length));const deduplicated=deduplicateDetections(allDetections);console.log(\"Total detections after deduplication: \".concat(deduplicated.length));console.log(\"Duplicates removed: \".concat(allDetections.length-deduplicated.length));return deduplicated;};// Enhanced deduplication for maximum accuracy\nconst deduplicateDetections=detections=>{const deduplicated=[];const seen=new Map();let duplicatesFound=0;detections.forEach(detection=>{// Create a sophisticated key that includes room and size context\nconst normalizedLabel=detection.label.toLowerCase().replace(/\\b(large|small|big|little|tall|short|wide|narrow|standard|medium)\\b/g,'').replace(/\\s+/g,' ').trim();const key=\"\".concat(normalizedLabel,\"-\").concat(detection.room,\"-\").concat(detection.sourcePhotoId);if(!seen.has(key)){seen.set(key,detection);deduplicated.push(detection);}else{// Merge quantities for similar items in the same photo and room\nconst existing=seen.get(key);console.log(\"\\uD83D\\uDD04 Merging duplicate: \\\"\".concat(detection.label,\"\\\" (\").concat(detection.qty,\" + \").concat(existing.qty,\" = \").concat(detection.qty+existing.qty,\")\"));existing.qty+=detection.qty;existing.confidence=Math.max(existing.confidence,detection.confidence);duplicatesFound++;// Update notes to include both descriptions\nif(detection.notes&&detection.notes!==existing.notes){existing.notes=\"\".concat(existing.notes,\"; \").concat(detection.notes);}}});console.log(\"\\u2705 Deduplication complete: \".concat(deduplicated.length,\" unique items, \").concat(duplicatesFound,\" duplicates merged\"));return deduplicated;};","map":{"version":3,"names":["estimateCubicFeet","estimateWeight","detectFurniture","photoUrls","console","log","length","process","env","REACT_APP_OPENAI_API_KEY","Error","allDetections","photoUrl","response","fetch","method","headers","concat","body","JSON","stringify","model","messages","role","content","type","text","image_url","url","detail","max_tokens","temperature","ok","errorText","error","status","data","json","choices","message","cleanContent","trim","startsWith","replace","analysis","parse","forEach","item","cubicFeet","weight","label","size","push","qty","confidence","sourcePhotoId","notes","room","parseError","deduplicated","deduplicateDetections","detections","seen","Map","duplicatesFound","detection","normalizedLabel","toLowerCase","key","has","set","existing","get","Math","max"],"sources":["/Users/admin/random/src/lib/aiDetectionServices.ts"],"sourcesContent":["import { Detection } from '../types';\nimport { estimateCubicFeet, estimateWeight } from './cubicFeetEstimator';\n\n// OpenAI GPT-4 Vision - PRIMARY AND ONLY detection method for maximum accuracy\nexport const detectFurniture = async (photoUrls: string[]): Promise<Detection[]> => {\n  console.log('Starting OpenAI GPT-4 Vision detection for', photoUrls.length, 'photos');\n  console.log('OpenAI API Key configured:', !!process.env.REACT_APP_OPENAI_API_KEY);\n  \n  if (!process.env.REACT_APP_OPENAI_API_KEY) {\n    throw new Error('OpenAI API key not configured');\n  }\n\n  const allDetections: Detection[] = [];\n  \n  for (const photoUrl of photoUrls) {\n    try {\n      console.log('Analyzing photo with OpenAI GPT-4 Vision:', photoUrl);\n      \n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model: 'gpt-4o', // Using latest GPT-4o model for best accuracy\n          messages: [{\n            role: 'user',\n            content: [\n                {\n                  type: 'text',\n                  text: `You are a professional MOVING COMPANY inventory specialist. Analyze this real estate photo and identify ONLY items that professional movers can physically move and transport.\n\nðŸšš MOVER'S INVENTORY - ONLY DETECT MOVABLE ITEMS:\n\nâœ… MOVABLE FURNITURE & ITEMS (DETECT THESE):\n- SEATING: Sofas, Sectionals, Loveseats, Recliners, Chairs (Dining, Office, Accent), Ottomans, Benches, Stools\n- TABLES: Dining Tables, Coffee Tables, End Tables, Console Tables, Side Tables, Kitchen Islands (if freestanding)\n- BEDS: King Beds, Queen Beds, Twin Beds, Bunk Beds, Daybeds, Futons, Mattresses, Box Springs\n- STORAGE: Dressers, Chests of Drawers, Nightstands, Bookshelves, Freestanding Cabinets, Wardrobes, Armoires\n- APPLIANCES: Refrigerators, Stoves, Ovens, Microwaves, Dishwashers, Washers, Dryers, Toasters, Coffee Makers\n- ELECTRONICS: TVs, Monitors, Computers, Laptops, Sound Systems, Gaming Consoles, Speakers\n- DECOR: Floor Lamps, Table Lamps, Mirrors (wall-mounted), Artwork, Plants, Vases, Clocks, Area Rugs\n- KITCHEN: Freestanding Pantries, Wine Racks, Bar Stools, Kitchen Carts\n- OUTDOOR: Patio Furniture, Grills, Outdoor Chairs/Tables\n\nâŒ DO NOT DETECT (FIXED INSTALLATIONS):\n- Built-in cabinets, Built-in shelving, Built-in vanities\n- Chandeliers, Ceiling fans, Light fixtures\n- Built-in appliances (dishwashers, built-in ovens)\n- Built-in bathroom vanities, Medicine cabinets\n- Built-in wardrobes, Built-in closets\n- Wall-mounted items (unless easily removable)\n- Built-in countertops, Built-in islands\n- Fixed mirrors, Built-in mirrors\n- Built-in seating, Built-in benches\n\nCRITICAL REQUIREMENTS:\n1. COUNT EXACT QUANTITIES - If you see 4 dining chairs, write qty: 4\n2. BE HIGHLY SPECIFIC - \"Large Oak Dining Table\", \"Sectional Sofa with Ottoman\", \"King Size Platform Bed\"\n3. INCLUDE ROOM CONTEXT - \"Master Bedroom Dresser\", \"Kitchen Island Stools\", \"Living Room Coffee Table\"\n4. DISTINGUISH SIMILAR ITEMS - \"Coffee Table\" vs \"End Table\" vs \"Console Table\"\n5. SIZE DESCRIPTORS - CRITICAL FOR MOVERS:\n   - TVs: Estimate screen size in inches (e.g., \"40-50 inch TV\", \"55-65 inch TV\", \"70+ inch TV\"). If unsure, provide a reasonable range based on visual scale compared to furniture nearby.\n   - Furniture: Provide dimensions or size range when possible (e.g., \"Large (7-8 ft)\", \"Small (4-5 ft)\", \"Queen Size\", \"King Size\"). Estimate based on visual scale or standard sizes.\n   - If exact size is unclear, provide a reasonable range (e.g., \"Medium-Large\", \"30-40 inches wide\")\n6. ONLY MOVABLE ITEMS - Skip anything permanently attached or built-in\n\nReturn ONLY a valid JSON array with objects containing:\n- label: VERY SPECIFIC movable furniture type with descriptors (string)\n- qty: EXACT quantity visible (number) \n- confidence: confidence score 0-1 (number)\n- notes: room location and specific details (string)\n- room: room type (string)\n- size: size descriptor with specific measurements or ranges - CRITICAL for TVs: estimate inches (e.g., \"55-inch\", \"65-75 inch range\"). For furniture: dimensions or size category with ranges (e.g., \"Large (7-8 ft)\", \"Queen Size\", \"30-40 inches wide\")\n- cubicFeet: **REQUIRED** - estimated cubic feet volume for this item (number). ALWAYS provide this field using standard moving industry estimates. Examples:\n  * Sofa (3-cushion): 35 cu ft\n  * Loveseat: 30 cu ft\n  * Dining chair: 5 cu ft\n  * Dining table (4-6 seater): 30 cu ft\n  * Queen bed: 65 cu ft\n  * King bed: 70 cu ft\n  * Dresser (medium): 40 cu ft\n  * TV 55\": 45 cu ft\n  * TV 60\"+: 55 cu ft\n  * Refrigerator: 35 cu ft\n  * Washer/Dryer: 25 cu ft each\n  * Piano (upright): 70 cu ft\n  * Pool table: 40 cu ft\n  * For items not listed, estimate based on dimensions and industry standards\n- weight: **REQUIRED** - estimated weight in pounds (number). ALWAYS provide this field using Saturn Star Movers cube sheet standards:\n  * 3-cushion sofa: 245 lbs\n  * Loveseat: 210 lbs\n  * Armchair: 105 lbs\n  * Dining chair: 35 lbs\n  * Dining table: 210 lbs\n  * Coffee table: 84 lbs\n  * End table: 35 lbs\n  * Queen bed: 455 lbs\n  * King bed: 490 lbs\n  * Dresser (medium): 280 lbs\n  * Dresser (large 8+): 350 lbs\n  * TV 40-49\": 280 lbs\n  * TV 50-59\": 315 lbs\n  * TV 60\"+: 385 lbs\n  * Refrigerator (â‰¤6 cu ft): 210 lbs\n  * Refrigerator (7-10 cu ft): 315 lbs\n  * Washer/Dryer: 175 lbs each\n  * Microwave: 70 lbs\n  * Upright piano: 490 lbs\n  * Baby grand piano: 560 lbs\n  * Pool table: 280 lbs\n  * Box (medium): 21 lbs\n  * Box (large): 42 lbs\n  * For other items: use ~7 lbs per cubic foot as rule of thumb\n\nEXAMPLE OUTPUT:\n[\n  {\n    \"label\": \"Large Oak Dining Table\",\n    \"qty\": 1,\n    \"confidence\": 0.98,\n    \"notes\": \"Dining room centerpiece, seats 6-8 people\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Large\",\n    \"cubicFeet\": 30,\n    \"weight\": 210\n  },\n  {\n    \"label\": \"Dining Chairs\",\n    \"qty\": 6,\n    \"confidence\": 0.95,\n    \"notes\": \"Matching upholstered dining chairs around table\",\n    \"room\": \"Dining Room\",\n    \"size\": \"Standard\",\n    \"cubicFeet\": 5,\n    \"weight\": 35\n  },\n  {\n    \"label\": \"TV\",\n    \"qty\": 1,\n    \"confidence\": 0.92,\n    \"notes\": \"Wall-mounted TV in living room\",\n    \"room\": \"Living Room\",\n    \"size\": \"55-65 inch range\",\n    \"cubicFeet\": 45,\n    \"weight\": 315\n  },\n  {\n    \"label\": \"Coffee Table\",\n    \"qty\": 1,\n    \"confidence\": 0.90,\n    \"notes\": \"Center of living room\",\n    \"room\": \"Living Room\",\n    \"size\": \"Large (5-6 ft long)\",\n    \"cubicFeet\": 12,\n    \"weight\": 84\n  }\n]\n\nRemember: Only detect items that professional movers can physically pick up and transport. Skip built-in, fixed, or permanently installed items.`\n                },\n              {\n                type: 'image_url',\n                image_url: { \n                  url: photoUrl,\n                  detail: 'high' // Maximum detail for best accuracy\n                }\n              }\n            ]\n          }],\n          max_tokens: 2000, // Increased for detailed responses\n          temperature: 0.1 // Low temperature for consistent, accurate results\n        })\n      });\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('OpenAI API error:', response.status, errorText);\n        continue;\n      }\n      \n      const data = await response.json();\n      const content = data.choices[0].message.content;\n      \n      console.log('OpenAI response:', content);\n      \n      // Parse the JSON response\n      try {\n        // Clean the response by removing markdown code blocks\n        let cleanContent = content.trim();\n        if (cleanContent.startsWith('```json')) {\n          cleanContent = cleanContent.replace(/^```json\\s*/, '').replace(/\\s*```$/, '');\n        } else if (cleanContent.startsWith('```')) {\n          cleanContent = cleanContent.replace(/^```\\s*/, '').replace(/\\s*```$/, '');\n        }\n        \n        const analysis = JSON.parse(cleanContent);\n        \n        // Add source photo ID to each detection\n        analysis.forEach((item: any) => {\n          // Use detected cubicFeet/weight if provided, otherwise estimate\n          let cubicFeet = item.cubicFeet;\n          let weight = item.weight;\n          \n          if (!cubicFeet || cubicFeet === 0) {\n            // Fallback to estimator\n            cubicFeet = estimateCubicFeet(item.label, item.size);\n            console.log(`âš ï¸ Missing cubicFeet for \"${item.label}\", estimated: ${cubicFeet} cu ft`);\n          }\n          \n          if (!weight || weight === 0) {\n            // Estimate weight from cubic feet and item label (more accurate)\n            weight = estimateWeight(cubicFeet, item.label, item.size);\n          }\n          \n          allDetections.push({\n            label: item.label,\n            qty: item.qty || 1,\n            confidence: item.confidence || 0.9,\n            sourcePhotoId: photoUrl,\n            notes: item.notes || `Detected by OpenAI GPT-4o`,\n            room: item.room || 'Unknown Room',\n            size: item.size || '',\n            cubicFeet: cubicFeet,\n            weight: weight\n          });\n        });\n        \n        console.log(`Detected ${analysis.length} items in photo`);\n        \n      } catch (parseError) {\n        console.error('Failed to parse OpenAI response:', parseError);\n        console.log('Raw response:', content);\n      }\n      \n    } catch (error) {\n      console.error('OpenAI Vision error:', error);\n      // Continue with other photos even if one fails\n    }\n  }\n  \n  console.log(`Total detections before deduplication: ${allDetections.length}`);\n  const deduplicated = deduplicateDetections(allDetections);\n  console.log(`Total detections after deduplication: ${deduplicated.length}`);\n  console.log(`Duplicates removed: ${allDetections.length - deduplicated.length}`);\n  return deduplicated;\n};\n\n// Enhanced deduplication for maximum accuracy\nconst deduplicateDetections = (detections: Detection[]): Detection[] => {\n  const deduplicated: Detection[] = [];\n  const seen = new Map<string, Detection>();\n  let duplicatesFound = 0;\n  \n  detections.forEach(detection => {\n    // Create a sophisticated key that includes room and size context\n    const normalizedLabel = detection.label.toLowerCase()\n      .replace(/\\b(large|small|big|little|tall|short|wide|narrow|standard|medium)\\b/g, '')\n      .replace(/\\s+/g, ' ')\n      .trim();\n    \n    const key = `${normalizedLabel}-${detection.room}-${detection.sourcePhotoId}`;\n    \n    if (!seen.has(key)) {\n      seen.set(key, detection);\n      deduplicated.push(detection);\n    } else {\n      // Merge quantities for similar items in the same photo and room\n      const existing = seen.get(key)!;\n      console.log(`ðŸ”„ Merging duplicate: \"${detection.label}\" (${detection.qty} + ${existing.qty} = ${detection.qty + existing.qty})`);\n      existing.qty += detection.qty;\n      existing.confidence = Math.max(existing.confidence, detection.confidence);\n      duplicatesFound++;\n      \n      // Update notes to include both descriptions\n      if (detection.notes && detection.notes !== existing.notes) {\n        existing.notes = `${existing.notes}; ${detection.notes}`;\n      }\n    }\n  });\n  \n  console.log(`âœ… Deduplication complete: ${deduplicated.length} unique items, ${duplicatesFound} duplicates merged`);\n  return deduplicated;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}